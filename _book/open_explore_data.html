<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Introduction to quantitative analysis with R - 4&nbsp; Opening and exploring data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./combining_summarising.html" rel="next">
<link href="./objects_functions.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./open_explore_data.html"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Opening and exploring data</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">Introduction to quantitative analysis with R</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Welcome!</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./intro.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Introduction to RStudio</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./syntax.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">R syntax</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./objects_functions.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R objects, functions and packages</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./open_explore_data.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Opening and exploring data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./combining_summarising.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Combining and summarising datasets</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./excel_data.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">Loading and tidying Excel data</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./visualisation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">Data visualisation</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#styles-of-r-coding" id="toc-styles-of-r-coding" class="nav-link active" data-scroll-target="#styles-of-r-coding"><span class="header-section-number">4.1</span> Styles of R coding</a></li>
  <li><a href="#the-working-directory" id="toc-the-working-directory" class="nav-link" data-scroll-target="#the-working-directory"><span class="header-section-number">4.2</span> The working directory</a>
  <ul class="collapse">
  <li><a href="#r-projects" id="toc-r-projects" class="nav-link" data-scroll-target="#r-projects"><span class="header-section-number">4.2.1</span> R projects</a></li>
  </ul></li>
  <li><a href="#loading-data" id="toc-loading-data" class="nav-link" data-scroll-target="#loading-data"><span class="header-section-number">4.3</span> Loading data</a></li>
  <li><a href="#selecting-variables" id="toc-selecting-variables" class="nav-link" data-scroll-target="#selecting-variables"><span class="header-section-number">4.4</span> Selecting variables</a></li>
  <li><a href="#filtering-data" id="toc-filtering-data" class="nav-link" data-scroll-target="#filtering-data"><span class="header-section-number">4.5</span> Filtering data</a></li>
  <li><a href="#pipes" id="toc-pipes" class="nav-link" data-scroll-target="#pipes"><span class="header-section-number">4.6</span> Pipes</a></li>
  <li><a href="#creating-new-variables" id="toc-creating-new-variables" class="nav-link" data-scroll-target="#creating-new-variables"><span class="header-section-number">4.7</span> Creating new variables</a></li>
  <li><a href="#other-useful-dplyr-functions" id="toc-other-useful-dplyr-functions" class="nav-link" data-scroll-target="#other-useful-dplyr-functions"><span class="header-section-number">4.8</span> Other useful <code>dplyr</code> functions</a></li>
  <li><a href="#a-smooth-process-to-the-analysis-dataset" id="toc-a-smooth-process-to-the-analysis-dataset" class="nav-link" data-scroll-target="#a-smooth-process-to-the-analysis-dataset"><span class="header-section-number">4.9</span> A smooth process to the analysis dataset</a></li>
  <li><a href="#exercise-3" id="toc-exercise-3" class="nav-link" data-scroll-target="#exercise-3"><span class="header-section-number">4.10</span> Exercise 3</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">Opening and exploring data</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<section id="styles-of-r-coding" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="styles-of-r-coding"><span class="header-section-number">4.1</span> Styles of R coding</h2>
<p>Up to this point, beyond the style tips sprinkled through these notes, we have not thought about the style of R coding we will be using. There are different approaches to R coding that we can use, they can be thought of as different dialects of the R programming language.</p>
<p>The choice of R ‘dialect’ depends on personal preference. Some prefer to use the ‘base R’ approach that does not rely on any packages that may need updating, making it a more stable approach. However, base R can be difficult to read for those not comfortable with coding.</p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="open_explore_data_files/figure-html/boyfriend meme-1.png" class="img-fluid figure-img"></p>
</figure>
</div>
</div>
</div>
<p>The alternative approach that we will be adopting in this course is the ‘tidyverse’ approach. Tidyverse is a set of packages that have been designed to make R coding more readable and efficient. They have been designed with reproducibility in mind, which means there is a wealth of online (mostly free), well-written resources available to help use these packages. Tidyverse is also the preferred coding style of the Government Analysis Function guidance.</p>
<p>If you have not done so already, install the Tidyverse packages to your machine using the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">'tidyverse'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>This can take a long time if you have never downloaded the tidyverse packages before as there are many dependencies that are required.</p>
<p>Do not stress if you get a lot of text in the console! This is normal, but watch out for any error messages.</p>
</div>
</div>
<p>Once the tidyverse package is installed, we must load it into the current working session. At the beginning of your script file add the following syntax:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Style tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>The double colon in R can be used to run a function within an installed package without loading the entire package to an R session.</p>
</div>
</div>
</section>
<section id="the-working-directory" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="the-working-directory"><span class="header-section-number">4.2</span> The working directory</h2>
<p>The working directory is a file path on your computer that R sets as the default location when opening, saving, or exporting documents, files, and graphics. This file path can be specified manually but setting the working directory saves time and makes code more efficient.</p>
<p>The working directory can be set manually by using the <em>Session -&gt; Set Working Directory -&gt; Change Directory…</em> option from the drop-down menu, or the <code>setwd</code> function. Both options require the directory to be specified each time R is restarted, are sensitive to changes in folders within the file path, and cannot be used when script files are shared between colleagues.</p>
<p>An alternative approach that overcomes all these issues is to create an R project.</p>
<section id="r-projects" class="level3" data-number="4.2.1">
<h3 data-number="4.2.1" class="anchored" data-anchor-id="r-projects"><span class="header-section-number">4.2.1</span> R projects</h3>
<p>R projects are files (saved with the <code>.Rproj</code> extension) that keep associated files (including scripts, data, and outputs) grouped together. An R project automatically sets the working directory relative to its current location, which makes collaborative work easier, and avoids issues when a file path is changed.</p>
<p>Projects are created by using the <em>File -&gt; New project</em> option from the drop-down menu, or using the <img src="img/project_icon.png" class="img-fluid" alt="R project icon"> icon from the top-right corner of the RStudio interface. Existing projects can be opened under the <em>File -&gt; Open project…</em> drop-down menu or using the project icon.</p>
<p>When creating a new project, we must choose whether we are creating a new directory or using an existing one. Usually, we will have already set up a folder containing data or other documents related to the analysis we plan to carry out. If this is the case, we are using an existing directory and selecting the analysis folder as the project directory.</p>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Style tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Have a clear order to your analysis folder. Consider creating separate folders within a project for input and output data, documentation, and outputs such as graphs or tables.</p>
</div>
</div>
</section>
</section>
<section id="loading-data" class="level2" data-number="4.3">
<h2 data-number="4.3" class="anchored" data-anchor-id="loading-data"><span class="header-section-number">4.3</span> Loading data</h2>
<p>To ensure our code is collaborative and reproducible, we should strive to store data in formats that can be used across multiple platforms. One of the best ways to do this is to store data as a comma-delimited file (.csv). CSV files can be opened by a range of different softwares (including R, SPSS, STATA and excel), and base R can be used to open these files without requiring additional packages.</p>
<p>Unfortunately, we are not always able to choose the format that data are stored in. For example, the English Housing Survey (EHS) data is stored as a .sav (SPSS) data file. Fortunately for us, R has a wide range of packages that have been developed to load data from every conceivable format.</p>
<p>The package that we will be using the load SPSS data is the <code>haven</code> package. To ensure this is loaded in at the beginning of each session, adapt the previous <code>p_load</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>pacman<span class="sc">::</span><span class="fu">p_load</span>(tidyverse, haven)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To avoid any errors arising from spelling mistakes, we can use the <code>list.files</code> function, which returns a list of files and folders from the current working directory. The file names can be copied from the console and pasted into the script file. As the data are saved in a folder within the working directory, we add the argument <code>path =</code> to specify the folder we want to list files from.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(<span class="at">path =</span> <span class="st">"data"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Detailed_forecast_tables_Economy_March_2024.xlsx"
[2] "generalfs21_EUL.sav"                             
[3] "interviewfs21_EUL.sav"                           </code></pre>
</div>
</div>
<p>The first data set we will load is the<code>generalfs21_EUL.sav</code> file. This contains general information taken from the English Housing Survey (EHS) from 2021, including a unique identifier, the responders’ region, and the tenure type.</p>
<p>The EHS data can be loaded into R using the <code>read_spss</code> function, and saved as an object using the <code>&lt;-</code> symbol:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>ehs_general <span class="ot">&lt;-</span> <span class="fu">read_spss</span>(<span class="at">file =</span> <span class="st">"Data/generalfs21_EUL.sav"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The imported data will appear in the environment with its given name. The contents of the object can be viewed by clicking on the object name in the environment, opening a tab next to script files. This window is a preview so cannot be edited here.</p>
<p>Some useful functions that can be used to explore a dataset include:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Return variable names</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(ehs_general)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "serialanon" "aagfh21"    "paired"     "tenure8x"   "tenure4x"  
[6] "tenure2x"   "gorehs"     "region3x"   "govreg1"   </code></pre>
</div>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns the first 6 rows</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(ehs_general)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  serialanon  aagfh21   paired      tenure8x tenure4x tenure2x gorehs   region3x
  &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;   &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt;
1 20220000001 3934.     1 [Paired]  1 [owne… 1 [owne… 1 [Priv…  7 [Eas… 3 [Rest…
2 20220000005 1580.     1 [Paired]  1 [owne… 1 [owne… 1 [Priv… 10 [Sou… 3 [Rest…
3 20220000006 3360.     1 [Paired]  1 [owne… 1 [owne… 1 [Priv…  6 [Wes… 3 [Rest…
4 20220000012 1368.     0 [Not pai… 1 [owne… 1 [owne… 1 [Priv…  5 [Eas… 3 [Rest…
5 20220000013 9847.     1 [Paired]  1 [owne… 1 [owne… 1 [Priv… 10 [Sou… 3 [Rest…
6 20220000017 3262.     0 [Not pai… 1 [owne… 1 [owne… 1 [Priv…  6 [Wes… 3 [Rest…
# ℹ 1 more variable: govreg1 &lt;dbl+lbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Returns the last 6 rows</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(ehs_general)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 9
  serialanon  aagfh21   paired      tenure8x tenure4x tenure2x gorehs   region3x
  &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;   &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt;
1 20220031393  262.     0 [Not pai… 3 [loca… 3 [loca… 2 [Soci…  7 [Eas… 3 [Rest…
2 20220031396 5741.     1 [Paired]  1 [owne… 1 [owne… 1 [Priv…  6 [Wes… 3 [Rest…
3 20220031401 1579.     0 [Not pai… 1 [owne… 1 [owne… 1 [Priv…  6 [Wes… 3 [Rest…
4 20220031402 2178.     0 [Not pai… 1 [owne… 1 [owne… 1 [Priv…  9 [Sou… 2 [Lond…
5 20220031408 1133.     1 [Paired]  1 [owne… 1 [owne… 1 [Priv… 10 [Sou… 3 [Rest…
6 20220031409 1879.     1 [Paired]  1 [owne… 1 [owne… 1 [Priv… 10 [Sou… 3 [Rest…
# ℹ 1 more variable: govreg1 &lt;dbl+lbl&gt;</code></pre>
</div>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Gives information about the structure of an object (including variable types)</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ehs_general)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [9,752 × 9] (S3: tbl_df/tbl/data.frame)
 $ serialanon: dbl+lbl [1:9752] 2.02e+10, 2.02e+10, 2.02e+10, 2.02e+10, 2.02e+10, 2.0...
   ..@ label        : chr "Key variable: unique archived identifier"
   ..@ format.spss  : chr "F11.0"
   ..@ display_width: int 13
   ..@ labels       : Named num [1:2] -9 -8
   .. ..- attr(*, "names")= chr [1:2] "Does not apply" "No Answer"
 $ aagfh21   : dbl+lbl [1:9752] 3934, 1580, 3360, 1368, 9847, 3262, 6584,  389, 4193,...
   ..@ label        : chr "Household weight 2021"
   ..@ format.spss  : chr "F8.2"
   ..@ display_width: int 10
   ..@ labels       : Named num [1:2] -9 -8
   .. ..- attr(*, "names")= chr [1:2] "Does not apply" "No answer"
 $ paired    : dbl+lbl [1:9752] 1, 1, 1, 0, 1, 0, 0, 0, 1, 1, 0, 1, 1, 1, 1, 0, 0, 1,...
   ..@ label      : chr "Whether paired sample case"
   ..@ format.spss: chr "F3.0"
   ..@ labels     : Named num [1:4] -9 -8 0 1
   .. ..- attr(*, "names")= chr [1:4] "Does not apply" "No Answer" "Not paired" "Paired"
 $ tenure8x  : dbl+lbl [1:9752] 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 4, 1, 4, 1, 1, 2, 4,...
   ..@ label        : chr "Tenure with vacancy"
   ..@ format.spss  : chr "F2.0"
   ..@ display_width: int 10
   ..@ labels       : Named num [1:10] -9 -8 1 2 3 4 5 6 7 8
   .. ..- attr(*, "names")= chr [1:10] "Does not apply" "No Answer" "owner occupied - occupied" "private rented - occupied" ...
 $ tenure4x  : dbl+lbl [1:9752] 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 1, 4, 1, 4, 1, 1, 2, 4,...
   ..@ label        : chr "Tenure"
   ..@ format.spss  : chr "F2.0"
   ..@ display_width: int 10
   ..@ labels       : Named num [1:6] -9 -8 1 2 3 4
   .. ..- attr(*, "names")= chr [1:6] "Does not apply" "No Answer" "owner occupied" "private rented" ...
 $ tenure2x  : dbl+lbl [1:9752] 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 1, 1, 2,...
   ..@ label        : chr "Tenure"
   ..@ format.spss  : chr "F2.0"
   ..@ display_width: int 10
   ..@ labels       : Named num [1:4] -9 -8 1 2
   .. ..- attr(*, "names")= chr [1:4] "Does not apply" "No Answer" "Private" "Social"
 $ gorehs    : dbl+lbl [1:9752]  7, 10,  6,  5, 10,  6,  4, 10,  7,  2, 10,  2,  2,  ...
   ..@ label      : chr "Government Office Region EHS version"
   ..@ format.spss: chr "F2.0"
   ..@ labels     : Named num [1:11] -9 -8 1 2 4 5 6 7 8 9 ...
   .. ..- attr(*, "names")= chr [1:11] "Does not apply" "No answer" "North East" "North West" ...
 $ region3x  : dbl+lbl [1:9752] 3, 3, 3, 3, 3, 3, 1, 3, 3, 1, 3, 1, 1, 3, 1, 2, 3, 1,...
   ..@ label        : chr "Overall region of England"
   ..@ format.spss  : chr "F2.0"
   ..@ display_width: int 10
   ..@ labels       : Named num [1:5] -9 -8 1 2 3
   .. ..- attr(*, "names")= chr [1:5] "Does not apply" "No Answer" "Northern regions" "London and South East regions" ...
 $ govreg1   : dbl+lbl [1:9752] 4, 4, 2, 2, 4, 2, 1, 4, 4, 1, 4, 1, 1, 2, 1, 4, 4, 1,...
   ..@ label        : chr "Government office Region, grouped"
   ..@ format.spss  : chr "F2.0"
   ..@ display_width: int 9
   ..@ labels       : Named num [1:6] -9 -8 1 2 3 4
   .. ..- attr(*, "names")= chr [1:6] "Does not apply" "No Answer" "North" "Midlands" ...
 - attr(*, "notes")= chr [1:6] "This third delivery file (interviewfs21.sav)" "was updated on 29/11/22" "   (Entered 01-Dec-2022)" "This third delivery file (interviewfs21.sav)" ...</code></pre>
</div>
</div>
<p>The <code>str</code> function tells us that this object is a <code>tibble</code>. This is tidyverse language for a data set (in base R, it is known as a <code>data.frame</code>). All variables are recognised as <code>dbl + lbl</code>, or labelled double variables. Double is tidyverse language for numeric data, and labels are taken from the original SPSS data.</p>
<p>It is important to check that R has correctly recognised variable type when data are loaded, before generating any visualisations or analysis. If variables are incorrectly specified, this could either lead to errors or invalid analyses. We will see how to change variables types later in this chapter.</p>
<p>The variables in this tibble contain additional information, stored as <code>attributes</code>. Data imported from other sources do not typically include these attributes by default, but these are able to uphold any information that was stored in the ‘Variable view’ window of SPSS.</p>
</section>
<section id="selecting-variables" class="level2" data-number="4.4">
<h2 data-number="4.4" class="anchored" data-anchor-id="selecting-variables"><span class="header-section-number">4.4</span> Selecting variables</h2>
<p>Often, we will not need every variable in a downloaded dataset to carry out an analysis, and we may wish to create a smaller analysis tibble. We may also wish to select individual variables from the tibble to apply functions to them without including the entire dataset.</p>
<p>To select one or more variable and return them as a new tibble, we can use the <code>select</code> function from tidyverse’s <code>dplyr</code> package.</p>
<p>For example, we do not need all the variables contained in the EHS general dataset. The variables we are interested in keeping are the unique identifier variables (<code>serialanon</code>), the survey weights (<code>aagfh21</code>), the tenure type response with 4 options (<code>tenure4x</code>), and the Government office region (<code>govreg1</code>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Variables can be selected using their names</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(ehs_general, serialanon, aagfh21, tenure4x, gorehs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,752 × 4
   serialanon  aagfh21   tenure4x           gorehs                       
   &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;          &lt;dbl+lbl&gt;                    
 1 20220000001 3934.     1 [owner occupied]  7 [East]                    
 2 20220000005 1580.     1 [owner occupied] 10 [South West]              
 3 20220000006 3360.     1 [owner occupied]  6 [West Midlands]           
 4 20220000012 1368.     1 [owner occupied]  5 [East Midlands]           
 5 20220000013 9847.     1 [owner occupied] 10 [South West]              
 6 20220000017 3262.     1 [owner occupied]  6 [West Midlands]           
 7 20220000022 6584.     1 [owner occupied]  4 [Yorkshire and the Humber]
 8 20220000025  389.     1 [owner occupied] 10 [South West]              
 9 20220000026 4193.     2 [private rented]  7 [East]                    
10 20220000027 3589.     1 [owner occupied]  2 [North West]              
# ℹ 9,742 more rows</code></pre>
</div>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Or their column number</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(ehs_general, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">7</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,752 × 4
   serialanon  aagfh21   tenure4x           gorehs                       
   &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;          &lt;dbl+lbl&gt;                    
 1 20220000001 3934.     1 [owner occupied]  7 [East]                    
 2 20220000005 1580.     1 [owner occupied] 10 [South West]              
 3 20220000006 3360.     1 [owner occupied]  6 [West Midlands]           
 4 20220000012 1368.     1 [owner occupied]  5 [East Midlands]           
 5 20220000013 9847.     1 [owner occupied] 10 [South West]              
 6 20220000017 3262.     1 [owner occupied]  6 [West Midlands]           
 7 20220000022 6584.     1 [owner occupied]  4 [Yorkshire and the Humber]
 8 20220000025  389.     1 [owner occupied] 10 [South West]              
 9 20220000026 4193.     2 [private rented]  7 [East]                    
10 20220000027 3589.     1 [owner occupied]  2 [North West]              
# ℹ 9,742 more rows</code></pre>
</div>
</div>
<p>The <code>select</code> function can also be combined with a number of ‘selection helper’ functions that help us select variables based on naming conventions:</p>
<ul>
<li><code>starts_with("xyz")</code> returns all variables with names beginning <code>xyz</code></li>
<li><code>ends_with("xyz")</code> returns all variables with names ending <code>xyz</code></li>
<li><code>contains("xyz")</code> returns all variables that have <code>xyz</code> within their name</li>
</ul>
<p>Or based on whether they match a condition:</p>
<ul>
<li><code>where(is.numeric)</code> returns all variables that are classed as numeric</li>
</ul>
<p>For a full list of these selection helpers, access the helpfile using <code>?tidyr_tidy_select</code>.</p>
<p>The <code>select</code> function can also be used to remove variables from a tibble by adding a <code>-</code> before the variable name or number. For example, to return the EHS general dataset without the unique identifier variable, we use:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(ehs_general, <span class="sc">-</span>serialanon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 9,752 × 8
   aagfh21   paired         tenure8x tenure4x tenure2x gorehs   region3x govreg1
   &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;      &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+lb&gt; &lt;dbl+l&gt;
 1 3934.     1 [Paired]     1 [owne… 1 [owne… 1 [Priv…  7 [Eas… 3 [Rest… 4 [Res…
 2 1580.     1 [Paired]     1 [owne… 1 [owne… 1 [Priv… 10 [Sou… 3 [Rest… 4 [Res…
 3 3360.     1 [Paired]     1 [owne… 1 [owne… 1 [Priv…  6 [Wes… 3 [Rest… 2 [Mid…
 4 1368.     0 [Not paired] 1 [owne… 1 [owne… 1 [Priv…  5 [Eas… 3 [Rest… 2 [Mid…
 5 9847.     1 [Paired]     1 [owne… 1 [owne… 1 [Priv… 10 [Sou… 3 [Rest… 4 [Res…
 6 3262.     0 [Not paired] 1 [owne… 1 [owne… 1 [Priv…  6 [Wes… 3 [Rest… 2 [Mid…
 7 6584.     0 [Not paired] 1 [owne… 1 [owne… 1 [Priv…  4 [Yor… 1 [Nort… 1 [Nor…
 8  389.     0 [Not paired] 1 [owne… 1 [owne… 1 [Priv… 10 [Sou… 3 [Rest… 4 [Res…
 9 4193.     1 [Paired]     2 [priv… 2 [priv… 1 [Priv…  7 [Eas… 3 [Rest… 4 [Res…
10 3589.     1 [Paired]     1 [owne… 1 [owne… 1 [Priv…  2 [Nor… 1 [Nort… 1 [Nor…
# ℹ 9,742 more rows</code></pre>
</div>
</div>
<p>After making changes to the analysis dataset, it is useful to save this data separately to the original raw data. This can be done using the <code>write_csv</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>ehs_general_reduced <span class="ot">&lt;-</span> <span class="fu">select</span>(ehs_general, serialanon, aagfh21, tenure4x, gorehs)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(ehs_general_reduced, <span class="at">file =</span> <span class="st">"ehs_general_reduced.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-warning callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Warning
</div>
</div>
<div class="callout-body-container callout-body">
<p>When saving updated tibbles as files, use a different file name to the original raw data. Using the same name will overwrite the original file. We always want a copy of the original in case of any errors or issues.</p>
</div>
</div>
<p>The <code>select</code> function returns variables as a tibble object. However, some functions, for example summary functions from base R, require data in the form of a <code>vector</code>. Vectors are lists of numbers with no formal structure, unlike a tibble which is structured to have rows and columns. To return a single variable as a vector, we can use the <code>$</code> symbol between the data name and the variable to return:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>ehs_general_reduced<span class="sc">$</span>aagfh21</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="filtering-data" class="level2" data-number="4.5">
<h2 data-number="4.5" class="anchored" data-anchor-id="filtering-data"><span class="header-section-number">4.5</span> Filtering data</h2>
<p>The <code>filter</code> function, from tidyverse’s <code>dplyr</code> package allows us to return subgroups of the data based on conditional statements. These conditional statements can include mathematical operators, e.g.&nbsp;<code>&lt;=</code> (less than or equal to), <code>==</code> (is equal to), and <code>!=</code> (is not equal to), or can be based on conditional functions, e.g.&nbsp;<code>is.na(variable)</code> (is missing), <code>between(a, b)</code> (number lies between a and b). A list of these conditional statements can be found in the help file using <code>?filter</code>.</p>
<p>For example, we may wish to return rows from the EHS dataset that were privately rented. To check which number refers to privately rented, we can check the <code>labels</code> attribute of the <code>tenure4x</code> variable which shows the labels from the SPSS file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(ehs_general_reduced<span class="sc">$</span>tenure4x)<span class="sc">$</span>labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Does not apply           No Answer      owner occupied      private rented 
                 -9                  -8                   1                   2 
    local authority housing association 
                  3                   4 </code></pre>
</div>
</div>
<p>Private rented is given by a 2 in the current dataset, therefore our conditional statement will return rows where the <code>tenure4x</code> variable takes the value 2.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(ehs_general_reduced, tenure4x <span class="sc">==</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,735 × 4
   serialanon  aagfh21   tenure4x           gorehs                       
   &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;          &lt;dbl+lbl&gt;                    
 1 20220000026 4193.     2 [private rented]  7 [East]                    
 2 20220000039  423.     2 [private rented]  7 [East]                    
 3 20220000075 1017.     2 [private rented]  7 [East]                    
 4 20220000092 1554.     2 [private rented]  7 [East]                    
 5 20220000113 5254.     2 [private rented]  8 [London]                  
 6 20220000132 7609.     2 [private rented]  4 [Yorkshire and the Humber]
 7 20220000134  775.     2 [private rented]  5 [East Midlands]           
 8 20220000135 1313.     2 [private rented]  1 [North East]              
 9 20220000187 1528.     2 [private rented]  8 [London]                  
10 20220000198  557.     2 [private rented] 10 [South West]              
# ℹ 1,725 more rows</code></pre>
</div>
</div>
<p>Multiple conditional statements can be added to the same function by separating them with a comma <code>,</code>. To return all respondents that lived in privately rented accommodation in the North East, we can extend the previous filter statement:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">attributes</span>(ehs_general_reduced<span class="sc">$</span>gorehs)<span class="sc">$</span>labels</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          Does not apply                No answer               North East 
                      -9                       -8                        1 
              North West Yorkshire and the Humber            East Midlands 
                       2                        4                        5 
           West Midlands                     East                   London 
                       6                        7                        8 
              South East               South West 
                       9                       10 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># North East is region 1</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(ehs_general_reduced, tenure4x <span class="sc">==</span> <span class="dv">2</span>, gorehs <span class="sc">==</span> <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 4
   serialanon  aagfh21   tenure4x           gorehs        
   &lt;dbl+lbl&gt;   &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;          &lt;dbl+lbl&gt;     
 1 20220000135  1313.    2 [private rented] 1 [North East]
 2 20220001633  3849.    2 [private rented] 1 [North East]
 3 20220002101  1016.    2 [private rented] 1 [North East]
 4 20220002817   323.    2 [private rented] 1 [North East]
 5 20220003959  2800.    2 [private rented] 1 [North East]
 6 20220004183   636.    2 [private rented] 1 [North East]
 7 20220005151 10707.    2 [private rented] 1 [North East]
 8 20220005393  2189.    2 [private rented] 1 [North East]
 9 20220005697  2059.    2 [private rented] 1 [North East]
10 20220005754   625.    2 [private rented] 1 [North East]
# ℹ 66 more rows</code></pre>
</div>
</div>
</section>
<section id="pipes" class="level2" data-number="4.6">
<h2 data-number="4.6" class="anchored" data-anchor-id="pipes"><span class="header-section-number">4.6</span> Pipes</h2>
<p>When creating an analysis-ready dataset, we often want to combine functions such as <code>select</code> and <code>filter</code>. Previously, these would need to be carried out separately and a new object would need to be created or overwritten at each step, clogging up the environment.</p>
<p>In tidyverse, we combine functions within a single process using the ‘pipe’ symbol <code>%&gt;%</code>, which is read as ‘and then’ within the code. For example, if we wanted to just select the unique identifiers of respondents that were privately renting in the North East, we could do this in a single process:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>ehs_general_reduced <span class="sc">%&gt;%</span> </span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(tenure4x <span class="sc">==</span> <span class="dv">2</span>, gorehs <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(serialanon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 76 × 1
   serialanon 
   &lt;dbl+lbl&gt;  
 1 20220000135
 2 20220001633
 3 20220002101
 4 20220002817
 5 20220003959
 6 20220004183
 7 20220005151
 8 20220005393
 9 20220005697
10 20220005754
# ℹ 66 more rows</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Style tips
</div>
</div>
<div class="callout-body-container callout-body">
<p>When combining multiple functions within a process using pipes, it is good practice to start the code with the data and pipe that into the functions, rather than including it in the function itself.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Helpful hint
</div>
</div>
<div class="callout-body-container callout-body">
<p>Rather than typing out pipes every time, use the keyboard shortcut <em>ctrl + shift + m</em> for Windows and <em>Command + shift + m</em> for Mac.</p>
</div>
</div>
</section>
<section id="creating-new-variables" class="level2" data-number="4.7">
<h2 data-number="4.7" class="anchored" data-anchor-id="creating-new-variables"><span class="header-section-number">4.7</span> Creating new variables</h2>
<p>The function <code>mutate</code> from tidyverse’s <code>dplyr</code> package allows us to add new variables to a dataset. We can add multiple variables within the same function, separating each with a comma <code>,</code>.</p>
<p>The <code>mutate</code> function is helpful when variable types are not correctly specified by R when they are read in. For example, the region and tenancy type variables in the <code>ehs_general_reduced</code> tibble are categorical variables but are currently recognised as numeric.</p>
<p>Categorical variables in R are known as <strong>factors</strong>. These factors can be ordered and can have labels assigned to different levels. To convert an existing variable to a factor, we can use the <code>factor</code> or <code>as_factor</code> functions. Here, we can combine the <code>mutate</code> and <code>as_factor</code> functions to convert tenancy type and region to factors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>ehs_general_reduced <span class="ot">&lt;-</span> <span class="fu">mutate</span>(ehs_general_reduced,</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">tenancy_type =</span> <span class="fu">as_factor</span>(tenure4x),</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">region =</span> <span class="fu">as_factor</span>(gorehs))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>As this data was taken from an SPSS file that had labels attached to the grouped variables, we do not need to specify these within the <code>as_factor</code> function.</p>
<p>When the variables do not have this labelling structure already, they will need to be added using the <code>label</code> argument of the <code>factor</code> function (see <code>?factor</code> for more information).</p>
</div>
</div>
<p>The <code>mutate</code> function can also be used to convert numeric variables into an ordered categorical variable, and can be used to transform variables using mathematical functions. For example, we can create two new variables, first giving the square root of the weighting variable, and second grouping the weighting variable into three categories (low: <span class="math inline">\(&lt; 1000\)</span>, medium: <span class="math inline">\(1000 \leq\)</span> <code>aagfh21</code> <span class="math inline">\(&lt; 5000\)</span>, high: <span class="math inline">\(\geq 5000\)</span>):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>ehs_general_reduced <span class="ot">&lt;-</span> <span class="fu">mutate</span>(ehs_general_reduced,</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weighting_sqrt =</span> <span class="fu">sqrt</span>(aagfh21),</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weighting_fct =</span> <span class="fu">cut</span>(aagfh21, </span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">1000</span>, <span class="dv">5000</span>, <span class="cn">Inf</span>),</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">right =</span> <span class="cn">TRUE</span>,</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>                                                  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">"Low"</span>, <span class="st">"Medium"</span>,</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>                                                              <span class="st">"High"</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Helpful hint
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>c</code> function takes a list of values separated by commas and returns them as a <code>vector</code>. This is useful when a function argument requires multiple values (and we don’t want R to move onto the next argument, which is what a comma inside functions usually means).</p>
</div>
</div>
</section>
<section id="other-useful-dplyr-functions" class="level2" data-number="4.8">
<h2 data-number="4.8" class="anchored" data-anchor-id="other-useful-dplyr-functions"><span class="header-section-number">4.8</span> Other useful <code>dplyr</code> functions</h2>
<p>To ensure our code follows the <a href="https://style.tidyverse.org/">tidyverse style guide</a>, variable names should be concise, <em>informative</em>, and contain no special charaters (other than <code>_</code>). The original variable names given in the original EHS data were definitely not stylish! To change names in a dataset, we can use the <code>rename</code> function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>ehs_general_reduced <span class="ot">&lt;-</span> <span class="fu">rename</span>(ehs_general_reduced,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                              <span class="at">id =</span> serialanon,</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                              <span class="at">weighting =</span> aagfh21)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>For more useful data exploration and manipulation functions from the <code>dplyr</code> package, I would recommending taking a look at the <strong>vignette</strong> associated with the package (a long-form version of a help file):</p>
<p><code>vignette("dplyr")</code></p>
<p>Or look at the <code>dplyr</code> <a href="https://rstudio.github.io/cheatsheets/data-transformation.pdf">cheatsheet</a>.</p>
</section>
<section id="a-smooth-process-to-the-analysis-dataset" class="level2" data-number="4.9">
<h2 data-number="4.9" class="anchored" data-anchor-id="a-smooth-process-to-the-analysis-dataset"><span class="header-section-number">4.9</span> A smooth process to the analysis dataset</h2>
<p>Our EHS analysis dataset has been created haphazardly through this chapter to demostrate each step separately. In reality, we would load this data and manipulate it in one process, separating steps by pipes <code>%&gt;%</code>.</p>
<p>The code below takes the data from its saw form (the .sav file) and transforms it into a clean dataset that we will be using for the rest of the course:</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 1: load the dataset into R and attach as an object</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>ehs_general_tidy <span class="ot">&lt;-</span> <span class="fu">read_spss</span>(<span class="at">file =</span> <span class="st">"Data/generalfs21_EUL.sav"</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 2: convert grouping variables into factors</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">mutate</span>(<span class="at">tenure_type =</span> <span class="fu">as_factor</span>(tenure4x),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">region =</span> <span class="fu">as_factor</span>(gorehs)) <span class="sc">%&gt;%</span> </span>
<span id="cb37-6"><a href="#cb37-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 3: rename other variables to avoid confusion</span></span>
<span id="cb37-7"><a href="#cb37-7" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">rename</span>(<span class="at">id =</span> serialanon,</span>
<span id="cb37-8"><a href="#cb37-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weighting =</span> aagfh21) <span class="sc">%&gt;%</span> </span>
<span id="cb37-9"><a href="#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 4: keep only the necessary variables</span></span>
<span id="cb37-10"><a href="#cb37-10" aria-hidden="true" tabindex="-1"></a>                    <span class="fu">select</span>(id, weighting, tenure_type, region)</span>
<span id="cb37-11"><a href="#cb37-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-12"><a href="#cb37-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Check the new data looks correct</span></span>
<span id="cb37-13"><a href="#cb37-13" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(ehs_general_tidy)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>tibble [9,752 × 4] (S3: tbl_df/tbl/data.frame)
 $ id         : dbl+lbl [1:9752] 2.02e+10, 2.02e+10, 2.02e+10, 2.02e+10, 2.02e+10, 2.0...
   ..@ label        : chr "Key variable: unique archived identifier"
   ..@ format.spss  : chr "F11.0"
   ..@ display_width: int 13
   ..@ labels       : Named num [1:2] -9 -8
   .. ..- attr(*, "names")= chr [1:2] "Does not apply" "No Answer"
 $ weighting  : dbl+lbl [1:9752] 3934, 1580, 3360, 1368, 9847, 3262, 6584,  389, 4193,...
   ..@ label        : chr "Household weight 2021"
   ..@ format.spss  : chr "F8.2"
   ..@ display_width: int 10
   ..@ labels       : Named num [1:2] -9 -8
   .. ..- attr(*, "names")= chr [1:2] "Does not apply" "No answer"
 $ tenure_type: Factor w/ 6 levels "Does not apply",..: 3 3 3 3 3 3 3 3 4 3 ...
  ..- attr(*, "label")= chr "Tenure"
 $ region     : Factor w/ 11 levels "Does not apply",..: 8 11 7 6 11 7 5 11 8 4 ...
  ..- attr(*, "label")= chr "Government Office Region EHS version"
 - attr(*, "notes")= chr [1:6] "This third delivery file (interviewfs21.sav)" "was updated on 29/11/22" "   (Entered 01-Dec-2022)" "This third delivery file (interviewfs21.sav)" ...</code></pre>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Step 5: save this tidy data as a new file in a saved_data folder</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(ehs_general_tidy, <span class="at">file =</span> <span class="st">"saved_data/ehs_general_tidy.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="exercise-3" class="level2" data-number="4.10">
<h2 data-number="4.10" class="anchored" data-anchor-id="exercise-3"><span class="header-section-number">4.10</span> Exercise 3</h2>
<ol type="1">
<li>You have been provided with another .sav file which contains the interview responses from the EHS. Create and save a tidy version of this dataset, ensuring variables are classified as the correct type and names follow the style conventions (if you cannot remember these, check <a href="https://style.tidyverse.org/syntax.html">here</a> for a reminder.</li>
</ol>
<p>The variables we need in the tidy dataset are:</p>
<ul>
<li>The unique identifier <code>serialanon</code></li>
<li>The gross household income <code>HYEARGRx</code></li>
<li>The length of residence <code>lenresb</code></li>
<li>The weekly rent <code>rentwkx</code> and mortgage <code>mortwkx</code> payments</li>
<li>Whether the property is freehold or leasehold <code>freeLeas</code></li>
</ul>
<ol start="2" type="1">
<li><p>Save the tidy interview dataset as a csv file with an appropriate file name.</p></li>
<li><p>Using the new, tidy dataset, answer the following questions:</p></li>
</ol>
<ul>
<li>How many respondents paid weekly rent of between £150 and £300?</li>
<li>How many respondents did not give a response to either the weekly rent or weekly mortgage question?</li>
<li>What is the highest household gross income of these responders?</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./objects_functions.html" class="pagination-link" aria-label="R objects, functions and packages">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">R objects, functions and packages</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./combining_summarising.html" class="pagination-link" aria-label="Combining and summarising datasets">
        <span class="nav-page-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Combining and summarising datasets</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->




</body></html>